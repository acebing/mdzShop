{extend name="public/layout" /}
{block name='menu'}
{include file='mall/menu' /}
{/block}
{block name='body'}
  	<span class="layui-breadcrumb">
     <a href="">平台设置</a>
     <a><cite>文章分类</cite></a>
   </span>
   <div class="layui-tab-content">
    <div class="layui-tab">
      <ul class="layui-tab-title">
        <li class="layui-this">通用信息</li>
        <li>文章内容</li>
        <li>关联商品</li>
      </ul>
      <div class="layui-tab-content">
       <div class="layui-tab-item layui-show">
        <div class="explanation mdz-m-b20" id="explanation">
          <div class="ex_tit">
            <i class="sc_icon"></i>
            <h4>操作提示</h4>
            <span id="explanationZoom" title="收起提示"></span>
          </div>
          <ul>
            <li>请注意选择文章分类；请严谨描述文章内容。</li>
            <li>标识“<em>*</em>”的选项为必填项，其余为选填项。</li>
          </ul>
        </div>
        <div class="flexilist">
          <div class="mian-info">
            <form action="">
              <div class="switch_info" style="display: block;">
                <div class="item">
                  <div class="label"><span class="require-field">*</span>&nbsp;文章标题：</div>
                  <div class="label_value">
                    <input type="text" name="title" class="text" value="" maxlength="40" autocomplete="off" id="title">
                    <div class="form_prompt"></div>
                  </div>
                </div>
                <!--  -->
                <div class="item">
                  <div class="label"><span class="require-field">*</span>&nbsp;文章分类：</div>
                  <div class="label_value">
                    <div id="parent_cat" class="imitate_select select_w320">
                      <div class="cite">请选择...</div>
                      <ul style="display: none;">
                       <li><a href="javascript:;" cat_type="2" data-value="1" class="ftx-01">购物指南</a></li><li><a href="javascript:;" cat_type="3" data-value="2" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;交易条款1</a></li><li><a href="javascript:;" cat_type="4" data-value="3" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;购物流程说明</a></li><li><a href="javascript:;" cat_type="5" data-value="1007" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易条款</a></li><li><a href="javascript:;" cat_type="5" data-value="1011" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;售后服务</a></li><li><a href="javascript:;" cat_type="5" data-value="1009" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支付问题</a></li><li><a href="javascript:;" cat_type="5" data-value="1005" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;购物流程</a></li><li><a href="javascript:;" cat_type="5" data-value="1008" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配送方式</a></li><li><a href="javascript:;" cat_type="5" data-value="1010" class="ftx-01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;发票问题</a></li><li><a href="javascript:;" cat_type="1" data-value="1000" class="ftx-01">微分销</a></li><li><a href="javascript:;" cat_type="1" data-value="14" class="ftx-01">商家入驻流程说明</a></li>                                      </ul>
                       <input name="article_cat" type="hidden" value="" id="parent_cat_val">
                     </div>
                     <div class="form_prompt"></div>
                   </div>
                 </div>
                 <div class="item">
                  <div class="label">文章重要性：</div>
                  <div class="label_value">
                    <div class="checkbox_items">
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="article_type" id="sex_0" value="0" checked="">
                        <label for="sex_0" class="ui-radio-label">普通</label>
                      </div>
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="article_type" id="sex_1" value="1">
                        <label for="sex_1" class="ui-radio-label">置顶</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="item">
                  <div class="label">是否显示：</div>
                  <div class="label_value">
                    <div class="checkbox_items">
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="is_open" id="sex_3" value="1" checked="">
                        <label for="sex_3" class="ui-radio-label">显示</label>
                      </div>
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="is_open" id="sex_4" value="0">
                        <label for="sex_4" class="ui-radio-label">不显示</label>
                      </div>
                    </div>
                  </div>
                </div>
                <!--  -->
                <div class="item">
                  <div class="label">文章作者：</div>
                  <div class="label_value"><input type="text" name="author" class="text" autocomplete="off" value=""></div>
                </div>
                <div class="item">
                  <div class="label">作者email：</div>
                  <div class="label_value"><input type="text" name="author_email" class="text" autocomplete="off" value=""></div>
                </div>
                <div class="item">
                  <div class="label">关键字：</div>
                  <div class="label_value"><input type="text" name="keywords" class="text" autocomplete="off" value=""></div>
                </div>
                <div class="item">
                  <div class="label">网页描述：</div>
                  <div class="label_value">
                    <textarea name="description" class="textarea"></textarea>
                  </div>
                </div>
                <div class="item">
                  <div class="label">排序：</div>
                  <div class="label_value"><input type="text" name="sort_order" class="text text_2" autocomplete="off" id="sort_order" value="50"></div>
                </div>
                <div class="item">
                  <div class="label">外部链接：</div>
                  <div class="label_value"><input type="text" name="link_url" class="text" autocomplete="off" id="link_url" value="http://"></div>
                </div>
                <div class="item">
                  <div class="label">上传文件：</div>
                  <div class="label_value">
                    <div class="type-file-box">
                      <input type="button" name="button" id="button" class="type-file-button" value="">
                      <input type="file" class="type-file-file" id="file" name="file" data-state="imgfile" size="30" hidefocus="true" value="">
                    </div>
                    <div class="notic">图片尺寸280*160</div>
                  </div>  
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="layui-tab-item">
        <div class="flexilist">
          <div class="mian-info">
            <form action="">
              <div class="explanation mdz-m-b20" id="explanation">
                <div class="ex_tit">
                  <i class="sc_icon"></i>
                  <h4>操作提示</h4>
                  <span id="explanationZoom" title="收起提示"></span>
                </div>
                <ul>
                  <li>请注意选择文章分类；请严谨描述文章内容。</li>
                  <li>标识“<em>*</em>”的选项为必填项，其余为选填项。</li>
                </ul>
              </div>
              <form action="">
               后端数据加载
             </form>
           </div>
         </div>
       </div>
       <div class="layui-tab-item"> <div class="flexilist">
        <div class="mian-info">
          <form action="">
            <div class="explanation mdz-m-b20" id="explanation">
              <div class="ex_tit">
                <i class="sc_icon"></i>
                <h4>操作提示</h4>
                <span id="explanationZoom" title="收起提示"></span>
              </div>
              <ul>
                <li>请注意选择文章分类；请严谨描述文章内容。</li>
                <li>标识“<em>*</em>”的选项为必填项，其余为选填项。</li>
              </ul>
            </div>
            <form action="">
              <div class="switch_info" style="display: block;">
                <div class="step" ectype="filter">
                  <div class="step_content">
                    <div class="goods_search_div">
                      <div class="search_select">
                        <div class="categorySelect">
                          <div class="selection">
                            <input type="text" name="category_name" id="category_name" class="text w250 valid" value="请选择分类" autocomplete="off" readonly="" data-filter="cat_name">
                            <input type="hidden" name="category_id" id="category_id" value="0" data-filter="cat_id">
                          </div>
                          <div class="select-container" style="display:none;">
                            <div class="select-top">
                              <a href="javascript:;" class="categoryTop" data-cid="0" data-cname="" data-diff="0" data-show="0" data-seller="0" data-table="category">重选</a>
                              &gt; <span>请选择分类</span>
                            </div>
                            <div class="select-list">
                              <ul>
                                <li data-cid="1" data-cname="未启用分类/图书、音像、电子书" data-diff="0" data-url="https://www.maidezhao.com/category.php?id=1" data-show="0" data-seller="0" data-table="category"><em>Ⅰ</em>未启用分类/图书、音像、电子书   </li>
                                <li data-cid="867" data-cname="品味七乡" data-diff="0" data-url="https://www.maidezhao.com/category.php?id=867" data-show="0" data-seller="0" data-table="category">
                                  <em>Ⅰ</em></li>
                              </ul>
                            </div>
                          </div>
                          </div>
                        </div>
                        <div class="search_select">
                          <div class="brandSelect">
                            <div class="selection">
                              <input type="text" name="brand_name" id="brand_name" class="text w120 valid" value="请选择品牌" autocomplete="off" readonly="" data-filter="brand_name">
                              <input type="hidden" name="brand_id" id="brand_id" value="0" data-filter="brand_id">
                            </div>
                            <div class="brand-select-container" style="display:none;">
                              <div class="brand-top">
                                <div class="letter">
                                  <ul>
                                    <li><a href="javascript:void(0);" data-letter="">全部品牌</a></li>
                                    <li><a href="javascript:void(0);" data-letter="A">A</a></li>
                                    <li><a href="javascript:void(0);" data-letter="QT">其他</a></li>
                                  </ul>
                                </div>
                                <div class="b_search">
                                  <input name="search_brand_keyword" id="search_brand_keyword" type="text" class="b_text" placeholder="品牌名称关键字查找" autocomplete="off">
                                  <a href="javascript:void(0);" class="btn-mini"><i class="icon icon-search"></i></a>
                                </div>
                              </div>
                              <div class="brand-list">
                                <ul>
                                  <li data-id="0" data-name="请选择品牌" class="blue">取消选择</li>
                                  <li data-id="214" data-name="vivo"><em>V</em>vivo</li>
                                </ul>
                              </div>
                              <div class="brand-not" style="display:none;">没有符合"<strong>其他</strong>"条件的品牌</div>                                                </div>
                            </div>
                          </div>
                          <input type="hidden" name="ru_id" value="">
                          <input type="text" name="keyword" class="text w150" placeholder="请输入关键字" autocomplete="off" data-filter="keyword">
                          <a href="javascript:void(0);" class="btn btn30" onclick="searchGoods()"><i class="icon icon-search"></i>搜索</a>
                        </div>
                        <div class="move_div">
                          <div class="move_left">
                            <h4>可选商品</h4>
                            <div class="move_info">
                              <div class="move_list" id="source_select">
                                <ul>
                                  <li data-value="2526" class=""><i class="sc_icon sc_icon_ok"></i><a href="javascript:;" data-value="2526" class="ftx-01">OPPO R15 全面屏双摄拍照手机 4G+128G 星空紫 全网通 移动联通电信4G 双卡双待手机</a><input type="hidden" name="user_search[]" value="2526"></li>
                                  <li data-value="2527" class="current"><i class="sc_icon sc_icon_ok"></i><a href="javascript:;" data-value="2527" class="ftx-01">OPPO R15 梦镜版 全面屏双摄拍照手机 6G+128G 梦镜红 全网通 移动联通电信4G 双卡双待手机</a><input type="hidden" name="user_search[]" value="2527"></li>
                                </ul> 
                              </div>
                            </div>
                            <div class="move_handle">
                              <a href="javascript:void(0);" class="btn btn25 moveAll" ectype="moveAll">全选</a>
                              <a href="javascript:void(0);" ectype="sub" data-operation="add_link_artic_goods" class="btn btn25 red_btn">确定</a>
                            </div>
                          </div>
                          <div class="move_middle">
                            <div class="move_point" onclick="addGoods()"></div>
                          </div>
                          <div class="move_right">
                            <h4>已选商品</h4>
                            <div class="move_info">
                              <div class="move_list" id="target_select">
                                <ul>
                                  <li data-value="2527" data-text="OPPO R15 梦镜版 全面屏双摄拍照手机 6G+128G 梦镜红 全网通 移动联通电信4G 双卡双待手机" class="current"><i class="sc_icon sc_icon_no"></i><a href="javascript:void(0);">OPPO R15 梦镜版 全面屏双摄拍照手机 6G+128G 梦镜红 全网通 移动联通电信4G 双卡双待手机</a></li>
                                  <li data-value="2529" data-text="OPPO A5 全面屏拍照手机 4GB+64GB 幻镜粉 全网通 移动联通电信4G 双卡双待手机" class=""><i class="sc_icon sc_icon_no"></i><a href="javascript:void(0);">OPPO A5 全面屏拍照手机 4GB+64GB 幻镜粉 全网通 移动联通电信4G 双卡双待手机</a></li>
                                </ul>                     
                              </div>
                            </div>
                            <div class="move_handle">
                              <a href="javascript:void(0);" class="btn btn25 moveAll" ectype="moveAll">全选</a>
                              <a href="javascript:void(0);" ectype="sub" data-operation="drop_link_artic_goods" class="btn btn25 btn_red">移除</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div></div>
        </div>
      </div>
  {/block}
{block name='js'}
  <script type="text/javascript">
       
    
        //会员基本信息 div仿select 
        $.divselect("#parent_cat","#parent_cat_val",function(obj){
      var select = obj.parents("#parent_cat");
      var val = obj.attr("cat_type");
      catChanged(val);
        });
    
        $(function(){
      $("#submitBtn").click(function(){
        if($("#article_form").valid()){
          $("#article_form").submit();
        }
      });
    
      $('#articlecat_form').validate({
        errorPlacement:function(error, element){
          var error_div = element.parents('div.label_value').find('div.form_prompt');
          element.parents('div.label_value').find(".notic").hide();
          error_div.append(error);
        },
                ignore:'.ignore',
        rules : {
          title : {
            required : true
          },
                    article_cat :{
                        required : true
                    }
        },
        messages : {
          title : {
            required : '<i class="icon icon-exclamation-sign"></i>'
          },
                    article_cat : {
                        required : '<i class="icon icon-exclamation-sign"></i>'
                    }
        }
      });
        });
    
        /**
        * 选取上级分类时判断选定的分类是不是底层分类
        */
        function catChanged(cat_type)
        {
              var text = "请选择...";
          
      if (cat_type == '')
      {
        cat_type = 1;
      }
      if (cat_type == 2 || cat_type == 4)
      {
        alert(not_allow_add);
        $("#parent_cat_val").val(0);
        $("#parent_cat .cite").html(text);
        return false;
      }
      return true;
        }
    
        function searchGoods(){
      var filters   = new Object;
      filters.cat_id = $("input[name='category_id']").val();
      filters.brand_id = $("input[name='brand_id']").val();
      filters.keyword = Utils.trim($("input[name='keyword']").val());
            $("#source_select").find("ul").html('<i class="icon-spinner icon-spin"></i>');
      
            setTimeout(function(){
                $.jqueryAjax("bonus.php?is_ajax=1&act=get_goods_list","JSON="+$.toJSON(filters), searchGoodsResponse, 'GET', 'JSON');
            },300);
        }
    
        function searchGoodsResponse(result){
            $("#source_select").find("li").remove();
            $("#source_select").find("ul").html('');
            var step = $("#source_select").parents(".step[ectype=filter]:first");
            var goods = result.content;
            if (goods)
            {
                    for (i = 0; i < goods.length; i++)
                    {
                            $("#source_select").children("ul").append("<li data-value='"+goods[i].value+"'><i class='sc_icon sc_icon_ok'></i><a href='javascript:;' data-value='"+goods[i].value+"' class='ftx-01'>"+goods[i].text+"</a><input type='hidden' name='user_search[]' value='"+goods[i].value+"'></li>")
                    }
            }
            step.find(".move_list").perfectScrollbar();
                        
        }
    
        function addGoods()
        {
            var step = $("#source_select").parents(".step[ectype=filter]:first");
      $("#source_select").find("li").each(function(){
        if($(this).attr("class") == 'current'){
          var user = $(this).text();
          var user_id = $(this).find("input").val();
          var exists = false;
          $("#target_select").find("li").each(function(){
            if($(this).find("input").val() == user_id){
              exists = true;
              return false;
            }
          })
          if(exists == false){
            $("#target_select").children("ul").append("<li><i class='sc_icon sc_icon_no'></i><a href='javascript:void(0);'>"+user+"</a><input type='hidden' name='target_select[]' value='"+user_id+"'></li>")      
          }
        }
      });       
      step.find(".move_left .move_list, .move_all .move_list").perfectScrollbar();
        }
    
        function delGoods()
        {
      <!-- var filters  = new Array(); -->
      $("#target_select").find("li").each(function(){
        if($(this).attr("class") == 'current'){
          <!-- filters.push($(this).find("a").data("value")); -->
          $(this).remove();
        }
      });
        }
    
  </script>
{/block}