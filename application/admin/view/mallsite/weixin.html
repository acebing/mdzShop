{extend name="public/layout" /}
  {block name='menu'}
{include file='mallsite/menu' /}
{/block}
  {block name='body'}
    	<span class="layui-breadcrumb">
       <a href="">平台设置</a>
       <a><cite>微信公众号设置</cite></a>
     </span>
     <div class="layui-tab-content">
      <div class="explanation" id="explanation">
        <div class="ex_tit"><i class="sc_icon"></i><h4>操作提示</h4><span id="explanationZoom" title="收起提示"></span></div>
          <ul>
            <li>一、配置前先需要申请一个微信服务号，并且通过微信认证。（认证服务号需要注意每年微信官方都需要重新认证，如果认证过期，接口功能将无法使用，具体请登录微信公众号平台了解详情）</li>
            <li>二、网站域名 需要通过ICP备案并正确解析到空间服务器，临时域名与IP地址无法配置。</li>
            <li>三、登录 <a href="https://mp.weixin.qq.com/" target="_blank">微信公众号平台 </a>，获取且依次填写好 公众号名称，公众号原始ID，Appid，Appsecret，token值。 </li>
            <li>四、自定义Token值，必须为英文或数字（长度为3-32字符），如 weixintoken，并保持后台与公众号平台填写的一致。 </li>
            <li>五、复制接口地址，填写到微信公众号平台 开发=&gt; 基本配置，服务器配置下的 URL地址，验证提交通过后，并启用。（注意仅支持80端口） </li>
          </ul>
      </div>
      <div class="flexilist">
      <div class="main-info">
        <!--<div class="panel-heading">公众号设置</div>-->
        <form method="post" action="/mobile/index.php?m=wechat&amp;c=admin&amp;a=modify" class="form-horizontal" role="form">
          <div class="switch_info">
            <div class="item">
              <div class="label-t">公众号名称</div>
              <div class="label_value">
                <input type="text" name="data[name]" class="text" value="砚山买得着">
                <div class="notic">* 如：ecmoban</div>
              </div>
            </div>
            <div class="item">
              <div class="label-t">公众号原始id</div>
              <div class="label_value">
                <input type="text" name="data[orgid]" class="text" value="gh_8793a66511e8">
                <div class="notic">* 请认真填写，如：gh_845581623321</div>
              </div>
            </div>
            <div class="item">
              <div class="label-t">AppID</div>
              <div class="label_value">
                <input type="text" name="data[appid]" class="text" value="wxdef38fb4ad683e17">
                <div class="notic">* AppID 请注意需要与微信公众号平台保持一致，且注意信息安全，不要随意透露给第三方</div>
              </div>
            </div>
            <div class="item">
              <div class="label-t">AppSecret</div>
              <div class="label_value">
                <input type="text" name="data[appsecret]" class="text" value="bd4**************************220">
                <div class="notic">* AppSecret密钥需要与微信公众号平台保持一致，没有特别原因不要随意修改，也不要随意透露给第三方</div>
              </div>
            </div>
            <div class="item">
              <div class="label-t">Token</div>
              <div class="label_value">
                <input type="text" name="data[token]" class="text" value="mdz123123">
                <div class="notic">* 自定义的Token值               <span class="btn btn-success makeToken">生成Token</span>

                <span class="btn btn-info btn-xs copyToken">复制Token</span>
                </div>
              </div>
            </div>
                <div class="item">
              <div class="label-t">EncodingAESKey</div>
              <div class="label_value">
                <input type="text" name="data[encodingaeskey]" class="text" value="ddlcsdcs4654987d9asdsada">
                <div class="notic">(选填) 由开发者手动填写或随机生成，将用作消息体加解密密钥</div>
              </div>
            </div>
           
            <div class="item">
              <div class="label-t">状态</div>
              <div class="label_value">
                <div class="checkbox_items">
                                <div class="checkbox_item">
                              <input type="radio" name="data[status]" class="ui-radio event_zhuangtai" id="value_118_0" value="1" checked="">
                              <label for="value_118_0" class="ui-radio-label active">开启</label>
                          </div>
                          <div class="checkbox_item">
                              <input type="radio" name="data[status]" class="ui-radio event_zhuangtai" id="value_118_1" value="0">
                              <label for="value_118_1" class="ui-radio-label ">关闭</label>
                          </div>
                                </div>
              </div>
            </div>
                        <div class="item">
              <div class="label-t">微信URL接口地址</div>
              <div class="label_value">
                <span class="text weixin_url">https://www.maidezhao.com/mobile/index.php?m=wechat&amp;key=90b7b09849da57289a9863364953ee9f</span>
                <span class="btn btn-info btn-xs copy">复制URL</span>
              </div>
            </div>
                        <div class="item">
              <div class="label-t">&nbsp;</div>
              <div class="label_value info_btn">
                <input type="hidden" name="id" value="1">
                <input type="hidden" name="data[type]" value="2">
                <input type="submit" name="submit" value="保存" class="button btn-danger bg-red">
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    </div>
  {/block}
{block name='js'}
  <script>
  // H5 复制粘贴 - execCommand http://www.jianshu.com/p/37322bb86a48  兼容IE8+，Chrome 45+, Firefox 43+
  var copyUrl = document.querySelector('.copy');
  // 点击的时候调用 copyTextToClipboard() 方法就好了.
  copyUrl.onclick = function() {
    copyTextToClipboard('https://www.maidezhao.com/mobile/index.php?m=wechat&key=90b7b09849da57289a9863364953ee9f');
  }

  var copyToken = document.querySelector('.copyToken');
  copyToken.onclick = function() {
    var newtoken = $("input[name='data[token]']").val();
    copyTextToClipboard(newtoken);
  }

  function copyTextToClipboard(text) {
    var textArea = document.createElement("textarea");
    textArea.style.position = 'fixed';
    textArea.style.top = 0;
    textArea.style.left = 0;
    textArea.style.width = '2em';
    textArea.style.height = '2em';
    textArea.style.padding = 0;
    textArea.style.border = 'none';
    textArea.style.outline = 'none';
    textArea.style.boxShadow = 'none';
    textArea.style.background = 'transparent';
    textArea.value = text;
    document.body.appendChild(textArea);

    textArea.select();
    try {
      var msg = document.execCommand('copy') ? '成功' : '失败';
      console.log('复制内容 ' + msg);
      layer.msg('复制内容 ' + msg);
    } catch (err) {
      console.log('浏览器不支持此复制方法');
      layer.msg('浏览器不支持此复制方法');
    }
    document.body.removeChild(textArea);
  }


  // 生成token md5
  $(".makeToken").click(function(){
    var mydate = new Date();
    var mytime = mydate.toLocaleTimeString(); //获取当前时间
    var token = $.md5(mytime);
    $("input[name='data[token]']").val(token);
  });

</script>
{/block}