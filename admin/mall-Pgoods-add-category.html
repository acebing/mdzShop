<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="./layui/css/layui.css">
  <link rel="stylesheet" href="./js/jquery-ui/jquery-ui.min.css">
  <link rel="stylesheet" type="text/css" href="./css/iconfont.css">
  <link rel="stylesheet" type="text/css" href="./css/font-awesome.min.css">
  <link rel="stylesheet" href="./css/perfect-scrollbar.min.css">
  <link rel="stylesheet" href="./css/purebox.css">
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="./css/order-new.css">
  <link rel="stylesheet" href="./css/mdz.css">
  <!-- js部分 -->
  <script src="http://www.jq22.com/jquery/jquery-2.1.1.js"></script>
  <script src="./js/jquery-ui/jquery-ui.min.js"></script>
  <script src="./layui/layui.js"></script>
  <script src="./js/mdz-layui.js"></script>
  <script src="./js/jquery.validation.min.js"></script>
  <script src="./js/perfect-scrollbar.min.js"></script>
  <script src="./js/lib_ecmobanFunc.js"></script>
  <script src="./js/listtable.js"></script>
  <script src="./js/region.js"></script>
  <script src="./js/common.js"></script>
  <script src="./js/admin.js"></script>
</head>
<body>
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo"><img src="./images/admin_logo.png" alt="" style="width: 210px;height: 25px"></div>
      <!-- 头部区域（可配合layui已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item"><a href="">平台设置</a></li>
        <li class="layui-nav-item layui-this"><a href="">商城管理</a></li>
        <li class="layui-nav-item"><a href="">财务管理</a></li>
        <li class="layui-nav-item"><a href="">微商城</a></li>
        <li class="layui-nav-item"><a href="">小程序</a></li>
      </ul>
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item">
          <a href="javascript:;">
            <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
            沈总
          </a>
          <dl class="layui-nav-child">
            <dd><a href="">基本资料</a></dd>
            <dd><a href="">安全设置</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
         <a href="">
          <i class="layui-icon layui-icon-notice" style="font-size: 20px; color: #FFF;"></i><span class="layui-badge">99</span>
        </a>
      </li>
      <li class="layui-nav-item">
      	<a href="">
      		<i class="layui-icon layui-icon-website" style="font-size: 20px; color: #FFF;"></i>
      	</a>
      </li>
      <li class="layui-nav-item">
      	<a href="">
      		<i class="layui-icon layui-icon-theme" style="font-size: 20px; color: #FFF;"></i>
      	</a>
      </li>
      <li class="layui-nav-item">
      	<a href="">
      		<i class="layui-icon layui-icon-fonts-clear" style="font-size: 20px; color: #FFF;"></i>
      	</a>
      </li>
      <li class="layui-nav-item">
      	<a href="">
      		<i class="layui-icon layui-icon-close-fill" style="font-size: 20px; color: #FFF;"></i>
      	</a>
      </li>
    </ul>
  </div>
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree"  lay-filter="test">
        <li class="layui-nav-item layui-nav-itemed">
          <a class="" href="javascript:;">平台商品管理</a>
          <dl class="layui-nav-child">
            <dd class="layui-this"><a href="javascript:;">商品列表</a></dd>
            <dd><a href="javascript:;">商品分类</a></dd>
            <dd><a href="javascript:;">品牌管理</a></dd>
            <dd><a href="javascript:;">评论管理</a></dd>
            <dd><a href="javascript:;">商品类型</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">超市商品管理</a>
          <dl class="layui-nav-child">
            <dd ><a href="javascript:;">商品列表</a></dd>
            <dd><a href="javascript:;">商品分类</a></dd>
            <dd><a href="javascript:;">品牌管理</a></dd>
            <dd><a href="javascript:;">评论管理</a></dd>
            <dd><a href="javascript:;">商品类型</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">省鲜生商品管理</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">商品列表</a></dd>
            <dd><a href="javascript:;">商品分类</a></dd>
            <dd><a href="javascript:;">品牌管理</a></dd>
            <dd><a href="javascript:;">评论管理</a></dd>
            <dd><a href="javascript:;">商品类型</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">订单管理</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">订单列表</a></dd>
            <dd><a href="javascript:;">添加订单</a></dd>
            <dd><a href="javascript:;">发货单列表</a></dd>
            <dd><a href="javascript:;">退货单列表</a></dd>
            <dd><a href="javascript:;">退货原因列表</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">文章管理</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">文章分类</a></dd>
            <dd><a href="javascript:;">文章列表</a></dd>
            <dd><a href="javascript:;">自动发布</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">会员管理</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">会员列表</a></dd>
            <dd><a href="javascript:;">资金管理</a></dd>
            <dd><a href="javascript:;">充值/提现</a></dd>
            <dd><a href="javascript:;">收货地址</a></dd>
            <dd><a href="javascript:;">发票</a></dd>
            <dd><a href="javascript:;">投诉管理</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a class="" href="javascript:;">活动促销</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">限时秒杀</a></dd>

          </dl>
        </li>
      </ul>
    </div>
  </div>
  
  <div class="layui-body" style="padding: 20px;">
  	<span class="layui-breadcrumb">
     <a href="">平台商品管理</a>
     <a><cite>平台分类</cite></a>
   </span>
   <div class="layui-tab-content">
    <div class="explanation mb10" id="explanation">
      <div class="ex_tit"><i class="sc_icon"></i><h4>操作提示</h4><span id="explanationZoom" title="收起提示"></span></div>
      <ul>
        <li>标识“<em>*</em>”的选项为必填项，其余为选填项。</li>
        <li>请按提示信息填写每一个字段。</li>
      </ul>
    </div>
    <div class="flexilist">
     <div class="flexilist">
      <div class="common-content">
        <div class="mian-info">
          <form action="category.php" method="post" name="theForm" enctype="multipart/form-data" id="category_info_form" novalidate="novalidate">
            <div class="switch_info">
              <div class="item">
                <div class="label"><span class="require-field">*</span>&nbsp;分类名称：</div>
                <div class="label_value">
                  <textarea name="cat_name" cols="48" rows="3" class="textarea"></textarea>
                  <div class="notic bf100">如需批量添加分类，格式：分类名称一,分类名称二,分类名称三 （注：以英文逗号分隔开）</div>
                  <div class="form_prompt"></div>
                </div>
              </div>
              <div class="item">
                <div class="label">分类别名：</div>
                <div class="label_value">
                  <input type="text" name="cat_alias_name" class="text" id="cat_alias_name" maxlength="20" value="" size="27">
                  <div class="notic">（注：分类名过长设置别名方便显示，字数设置为2-4个汉字字符）</div>
                </div>
              </div>
              <div class="item">
                <div class="label">手机小图标：</div>
                <div class="label_value">
                  <div class="type-file-box">
                    <input type="button" name="button" id="button" class="type-file-button" value="">
                    <input type="file" class="type-file-file" id="ad_img" name="touch_icon" data-state="imgfile" size="30" hidefocus="true" value="">
                    <input type="text" name="textfile" class="type-file-text" id="textfield" autocomplete="off" readonly="">
                  </div>
                  <div class="form_prompt"></div>
                  <div class="notic m20" id="AdCodeImg">（注：手机端专用,建议上传正方形图片（100*100））</div>
                </div>
              </div>
              <div class="item">
                <div class="label">上级分类：</div>
                <div class="label_value">
                  <div class="search_select">
                    <div class="categorySelect">
                      <div class="selection">
                        <input type="text" name="category_name" id="category_name" class="text w290 valid" value="顶级分类" autocomplete="off" readonly="" data-filter="cat_name">
                        <input type="hidden" name="parent_id" id="category_id" value="0" data-filter="cat_id">
                      </div>
                      <div class="select-container w319" style="display:none;">
                        <div class="select-top">
                          <a href="javascript:;" class="categoryTop" data-cid="0" data-cname="" data-diff="0" data-show="0" data-seller="0" data-table="category">重选</a>
                          &gt; <span>请选择分类</span>
                        </div>
                        <div class="select-list">
                          <ul>
                            <li data-cid="12" data-cname="买得着超市" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=12" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            买得着超市   </li>
                            <li data-cid="858" data-cname="家电家具" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=858" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            家电家具    </li>
                            <li data-cid="864" data-cname="未启用分类   腕表、珠宝配饰、眼镜" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=864" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            未启用分类   腕表、珠宝配饰、眼镜    </li>
                            <li data-cid="860" data-cname="美妆护肤" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=860" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            美妆护肤    </li>
                            <li data-cid="861" data-cname="农资农具" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=861" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            农资农具    </li>
                            <li data-cid="865" data-cname="母婴用品" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=865" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            母婴用品    </li>
                            <li data-cid="866" data-cname="运动健身" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=866" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            运动健身    </li>
                            <li data-cid="867" data-cname="品味七乡" data-diff="0" data-url="http://abc.maidezhao.com/category.php?id=867" data-show="0" data-seller="0" data-table="category">
                              <em>Ⅰ</em>
                            品味七乡    </li>
                          </ul>
                        </div>                        </div>
                      </div>
                    </div>
                    <div class="notic">不选择分类默认为顶级分类</div>
                  </div>
                </div> 
                <div class="item">
                  <div class="label">排序：</div>
                  <div class="label_value">
                    <input type="text" class="text text_4" name="sort_order" value="50" size="15" autocomplete="off">
                  </div>
                </div>  
                <div class="item">
                  <div class="label">佣金比率：</div>
                  <div class="label_value">
                    <input type="text" class="text text_2" name="commission_rate" value="" size="12" autocomplete="off">
                    <div class="notic">% （请输入0-100以内的整数）</div>
                  </div>
                </div>
                <div class="item">
                  <div class="label">是否显示：</div>
                  <div class="label_value">
                    <div class="checkbox_items">
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="is_show" id="is_show_1" value="1" checked="true">
                        <label for="is_show_1" class="ui-radio-label">是</label>
                      </div>
                      <div class="checkbox_item">
                        <input type="radio" class="ui-radio" name="is_show" id="is_show_0" value="0">
                        <label for="is_show_0" class="ui-radio-label">否</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="item" style=" display:none">
                  <div class="label">分类树顶级分类模块内容：</div>
                  <div class="label_value">
                    <textarea name="category_topic" rows="6" cols="48" class="textarea"></textarea>
                    <div class="notic">(格式：名称+"英文竖线"+链接地址)，每行一条数据。</div>
                  </div>
                </div>
                  <div class="item">
                    <div class="label">关键字：</div>
                    <div class="label_value">         
                      <input type="text" name="keywords" value="" size="50" class="text mr10" autocomplete="off">                   
                    </div>
                  </div>
                  <div class="item">
                    <div class="label">分类描述：</div>
                    <div class="label_value">         
                      <textarea name="cat_desc" rows="6" cols="48" class="textarea"></textarea>             
                    </div>
                  </div>
                  <div class="item">
                    <div class="label">&nbsp;</div>
                    <div class="label_value info_btn">
                      <input type="submit" value=" 确定 " class="button" id="submitBtn">
                      <input type="reset" value=" 重置 " class="button button_reset">
                      <input type="hidden" name="act" value="insert">
                      <input type="hidden" name="old_cat_name" value="">
                      <input type="hidden" name="cat_id" value="">
                    </div>
                  </div>                
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="layui-footer">
      <!-- 底部固定区域 -->
      <div  class="layui-main" style="text-align: center;">买得着商城<i class="heart">❤</i>不忘初心</div>
    </div>
  </div>
</body>
<script src="./js/jquery.purebox.js"></script>
<script type="text/javascript">

  $(function(){
  
    //表单验证
    $("#submitBtn").click(function(){
      if($("#category_info_form").valid()){
        $("#category_info_form").submit();
      }
    });
    
    jQuery.validator.addMethod("specialchar", function(value, element) {

      return this.optional(element) || !/[@'\\"#$%&\^*]/.test(value);   
    },("不能包含特殊字符"));
    
    $('#category_info_form').validate({
      errorPlacement:function(error, element){
        var error_div = element.parents('div.label_value').find('div.form_prompt');
        element.parents('div.label_value').find(".notic").hide();
        error_div.append(error);
      },
      rules:{
        cat_name :{
          required : true,
          specialchar:""
        }
      },
      messages:{
        cat_name:{
           required : '<i class="icon icon-exclamation-sign"></i>'+"分类名称不能为空"
        }
        
      }     
    });
  });
    
    // 分类分级 by qin
    function catList(val, level)
    {
        var cat_parent_id = val;
        Ajax.call('goods.php?is_ajax=1&act=sel_cat', 'cat_id='+cat_parent_id+'&cat_level='+level, catListResponse, 'GET', 'JSON');
    }
    
    function catListResponse(result)
    {
        document.getElementById('cat_parent_id').value = result.parent_id + "_" + Number(result.cat_level - 1);  
        if (result.error == '1' && result.message != '')
        {
            alert(result.message);
            return;
        }
        var response = result.content;
        var cat_level = result.cat_level; // 分类级别， 1为顶级分类
        for(var i=cat_level;i<10;i++)
        {
            $("#cat_list"+Number(i+1)).remove();
        }
        if(response)
        {
            $("#cat_list"+cat_level).after(response);
        }
        return;
    }
  
  //修改 by wu
  function changeCat(obj)
  {
    var obj = $(obj);
    var key = obj.data('value');
    
    if(arr[key]){
      var tArr = arr[key];
      var target = obj.parents(".imitate_select").next().find("ul");
      target.find("li:gt(0)").remove();
      for(var i=0; i<tArr.length; i++){
        var line = "<li><a href='javascript:;' data-value='"+tArr[i][1]+"' class='ftx-01'>"+tArr[i][0]+"</a></li>";
        target.append(line);
      }
    }
  }
  
</script>
</html>